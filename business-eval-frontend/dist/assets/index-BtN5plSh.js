import{r as l,j as e,u as k}from"./index-RnadGKpr.js";import{c as P,a as L,b as E,B as g,C as O,d as A,e as M,f as T,g as F}from"./card-D8WeG_2C.js";import{P as J,D as R,a as $,b as z,c as H,d as U,e as V,I as q,f as G,T as K}from"./dialog-Bb6PQOuR.js";import{u as Q}from"./buisnessSrore-C_Jv1e5S.js";import"./clsx-B-dksMZM.js";import"./axios-Bmm4lkOe.js";/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=P("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var X="Label",j=l.forwardRef((n,t)=>e.jsx(J.label,{...n,ref:t,onMouseDown:r=>{var d;r.target.closest("button, input, select, textarea")||((d=n.onMouseDown)==null||d.call(n,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));j.displayName=X;var _=j;const Y=E("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),N=l.forwardRef(({className:n,...t},r)=>e.jsx(_,{ref:r,className:L(Y(),n),...t}));N.displayName=_.displayName;function rs(){const[n,t]=l.useState([]),{fetchAllBusiness:r,addBusiness:p,deleteBusiness:d}=Q(),[w,h]=l.useState(!1),[v,o]=l.useState(!1),[c,x]=l.useState({business_name:"",business_location:"",business_url:"",current_cashflow:{value:0,notes:[]},asking_price:{value:0,notes:[]}}),m=localStorage.getItem("user_id"),f=k();l.useEffect(()=>{o(!0);const a=async()=>{try{const s=await r();if(localStorage.getItem("business_payload")){const i=JSON.parse(localStorage.getItem("business"));console.log("business",i),t([...n,i,...s.businesses])}else t(s.businesses)}catch(s){console.error("Error fetching businesses:",s)}finally{o(!1)}};if(m){if(a(),localStorage.getItem("business_payload")){const s=JSON.parse(localStorage.getItem("business"));console.log("business",s),t([...n,s]),o(!1)}}else{const s=localStorage.getItem("business");s&&(t([JSON.parse(s)]),o(!1))}o(!1)},[r,f,m]);const y=()=>{h(!0)},S=()=>{h(!1),x({business_name:"",business_location:"",business_url:"",current_cashflow:{value:0,notes:[]},asking_price:{value:0,notes:[]}})},C=a=>{const{name:s,value:i}=a.target;x(u=>({...u,[s]:s==="current_cashflow"||s==="asking_price"?{...u[s],value:parseFloat(i)}:i}))},B=async a=>{a.preventDefault();try{if(m){const s=await p(c);t([...n,s.newBusiness])}else{const s=crypto.randomUUID().replace(/-/g,"").substring(0,24);t([...n,{...c,_id:s}]),localStorage.setItem("business",JSON.stringify({...c,_id:s}))}S()}catch(s){console.error("Error adding business:",s)}},I=async a=>{try{m?(await d(a),t(n.filter(s=>s._id!==a))):(localStorage.removeItem("business"),t(n.filter(s=>s._id!==a)))}catch(s){console.error("Error deleting business:",s)}},D=a=>{f(`/dashboard/${a}`)};return v?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(W,{className:"animate-spin text-primary h-8 w-8"})}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"My Businesses"}),e.jsxs(R,{open:w,onOpenChange:h,children:[e.jsx($,{asChild:!0,children:e.jsxs(g,{onClick:y,children:[e.jsx(z,{className:"mr-2 h-4 w-4"})," Add Business"]})}),e.jsxs(H,{className:"sm:max-w-[425px]",children:[e.jsx(U,{children:e.jsx(V,{children:"Add New Business"})}),e.jsxs("form",{onSubmit:B,children:[e.jsx("div",{className:"grid gap-4 py-4",children:["business_name","business_location","business_url","current_cashflow","asking_price"].map(a=>{var s;return e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:a,className:"text-right capitalize",children:a.replace("_"," ")}),e.jsx(q,{id:a,name:a,type:a==="current_cashflow"||a==="asking_price"?"number":"text",value:a==="current_cashflow"||a==="asking_price"?(s=c[a])==null?void 0:s.value:c[a],onChange:C,className:"col-span-3"})]},a)})}),e.jsx(G,{children:e.jsx(g,{type:"submit",children:"Save changes"})})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(a=>{var s,i,u,b;return e.jsxs(O,{className:"cursor-pointer hover:shadow-lg transition-shadow",children:[e.jsx(A,{children:e.jsx(M,{children:a.business_name})}),e.jsxs(T,{children:[e.jsxs("p",{className:"text-sm mb-2",children:[e.jsx("span",{className:"font-medium",children:"Cashflow:"})," $",(i=(s=a.current_cashflow)==null?void 0:s.value)==null?void 0:i.toLocaleString()]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Asking Price:"})," $",(b=(u=a.asking_price)==null?void 0:u.value)==null?void 0:b.toLocaleString()]})]}),e.jsxs(F,{className:"flex justify-between",children:[e.jsx(g,{variant:"outline",onClick:()=>D(a._id),children:"View Details"}),e.jsx(g,{variant:"destructive",size:"icon",onClick:()=>I(a._id),children:e.jsx(K,{className:"h-4 w-4"})})]})]},a._id)})})]})}export{rs as default};
